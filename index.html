 <!DOCTYPE html>
<html>
<head>
  <title>KITENGELA INTERNATIONAL SCHOOL – CAS Log</title>
  <style>
  
  #toast {
    visibility: hidden;
    min-width: 300px;
    background-color: #111;
    color: #00ff7f; /* green success color */
    text-align: center;
    border-radius: 8px;
    padding: 16px;
    position: fixed;
    z-index: 1000;
    left: 50%;
    bottom: 30px;
    transform: translateX(-50%);
    font-weight: 500;
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.4); /* subtle gold glow */
    opacity: 0;
    transition: opacity 0.5s, bottom 0.5s;
  }

  #toast.show {
    visibility: visible;
    opacity: 1;
    bottom: 50px;
  }

    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      color: #333;
      max-width: 700px;
      margin: 40px auto;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input[type="text"],
    input[type="date"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    textarea { resize: vertical; }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: white;
      cursor: pointer;
      font-size: 15px;
    }
    button:hover { background: #0056b3; }

    /* Checkbox groups */
    .checkbox-group {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
      margin-left: 10px;
      margin-top: 8px;
    }
    .checkbox-group label {
      font-weight: normal;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>KITENGELA INTERNATIONAL SCHOOL<br>CAS Diary / Log Form</h2>

  <form id="casForm">
    <!-- Name and Adviser -->
    <label>Student Email / ID</label>
    <input type="text" name="studentId" id="studentId" required>
    <button type="button" onclick="checkHours()">Check My Hours</button>
    <p id="summary"></p>

    <label>Student Name (only first time)</label>
    <input type="text" name="studentName">

    <label>CAS Adviser</label>
    <input type="text" name="casAdviser">

    <!-- Date -->
    <label>Date</label>
    <input type="date" name="date" required>

    <!-- Activity -->
    <label>Activity Title</label>
    <input type="text" name="activityTitle" required>

    <!-- CAS Strand -->
    <label>CAS Strand</label>
    <div class="checkbox-group">
      <label><input type="checkbox" name="casStrand[]" value="Creativity"> Creativity</label>
      <label><input type="checkbox" name="casStrand[]" value="Action"> Action</label>
      <label><input type="checkbox" name="casStrand[]" value="Service"> Service</label>
    </div>

    <!-- Description -->
    <label>Description of the Activity</label>
    <textarea name="description" rows="3" required></textarea>

    <!-- Learning Outcomes -->
    <label>Learning Outcomes Addressed</label>
    <p>(Tick all that apply)</p>
    <div class="checkbox-group">
      <label><input type="checkbox" name="learningOutcomes[]" value="Identify own strengths and develop areas for growth"> Identify own strengths and develop areas for growth</label>
      <label><input type="checkbox" name="learningOutcomes[]" value="Demonstrate that challenges have been undertaken, developing new skills in the process"> Demonstrate that challenges have been undertaken, developing new skills in the process</label>
      <label><input type="checkbox" name="learningOutcomes[]" value="Demonstrate how to initiate and plan a CAS experience"> Demonstrate how to initiate and plan a CAS experience</label>
      <label><input type="checkbox" name="learningOutcomes[]" value="Show commitment to and perseverance in CAS experiences"> Show commitment to and perseverance in CAS experiences</label>
      <label><input type="checkbox" name="learningOutcomes[]" value="Demonstrate the skills and recognise the benefits of working collaboratively"> Demonstrate the skills and recognise the benefits of working collaboratively</label>
      <label><input type="checkbox" name="learningOutcomes[]" value="Demonstrate engagement with issues of global significance"> Demonstrate engagement with issues of global significance</label>
      <label><input type="checkbox" name="learningOutcomes[]" value="Recognise and consider the ethics of choices and actions"> Recognise and consider the ethics of choices and actions</label>
    </div>

    <!-- Reflection -->
    <label>Personal Reflection</label>
    <textarea name="reflection" rows="6" placeholder="What did I do? What did I learn about myself and others? How did I feel before, during, and after the activity? Did I face challenges, and how did I overcome them? How does this activity contribute to my personal growth and goals?" required></textarea>

    <!-- Hours Logged -->
    <label>Hours Logged</label>
    <div style="display: flex; gap: 10px;">
      <div><strong>Creativity:</strong><br><input type="number" name="creativityHours" min="0"></div>
      <div><strong>Action:</strong><br><input type="number" name="actionHours" min="0"></div>
      <div><strong>Service:</strong><br><input type="number" name="serviceHours" min="0"></div>
    </div>

    <button type="submit">Submit</button>
<div id="toast">✅ Your CAS activity has been submitted successfully!</div>

  </form>
<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyaejCuT2DXkmCoU8IfCsVLvt501t6xoDs9vg1P0JQHOP6f7dXM_fqUPdem1n9Wxd2w_g/exec";
const form = document.getElementById("casForm");
const summaryDiv = document.getElementById("hoursSummary");

// POST: submit new entry
form.addEventListener("submit", e => {
  e.preventDefault();

  // Correctly handle checkbox arrays
  const formData = new FormData(form);
  const data = {};
  for (const [key, value] of formData.entries()) {
    if (key.endsWith("[]")) {
      if (!data[key]) data[key] = [];
      data[key].push(value);
    } else {
      data[key] = value;
    }
  }

  fetch(scriptURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(res => {
    if (res.status === "success") {
      summaryDiv.style.color = "#00ff7f";
      summaryDiv.textContent = "✅ Hours submitted successfully!";
      form.reset();
    } else {
      summaryDiv.style.color = "red";
      summaryDiv.textContent = "❌ Submission failed: " + res.message;
    }
  })
  .catch(() => {
    summaryDiv.style.color = "red";
    summaryDiv.textContent = "❌ Network error. Please try again.";
  });
});

// GET: fetch total hours
function checkHours() {
  const studentId = document.getElementById("studentId").value.trim();
  if (!studentId) {
    summaryDiv.style.color = "orange";
    summaryDiv.textContent = "⚠️ Please enter your Student ID first.";
    return;
  }

  summaryDiv.style.color = "gold";
  summaryDiv.textContent = "⏳ Checking your hours...";

  fetch(`${scriptURL}?studentId=${encodeURIComponent(studentId)}`)
    .then(async res => {
      const text = await res.text();
      try {
        const data = JSON.parse(text);
        if (data.error) {
          summaryDiv.style.color = "red";
          summaryDiv.textContent = "❌ " + data.error;
        } else {
          // Keep the same theme/colors/layout as before
          summaryDiv.innerHTML = `
<div style="
  background:#eaf9ff;
  border:2px solid #4fc3f7;
  border-radius:14px;
  padding:22px;
  margin-top:18px;
  box-shadow:0 0 18px rgba(79,195,247,0.35);
  color:#003344;
  font-family:'Segoe UI',sans-serif;
  text-align:center;
  transition:all 0.3s ease;
  animation:fadeIn 0.4s ease;">
  
  <h3 style="margin:0;color:#00796b;">${data.studentName}</h3>
  <p style="margin:6px 0 14px;color:#0277bd;">ID: ${data.studentId}</p>

  <div style="
    display:flex;
    justify-content:space-around;
    margin:15px 0;
    font-size:1.05em;">
    <div>
      <span style="color:#0288d1;">Creativity</span><br>
      <b>${data.creativityHours || 0}</b> hrs
    </div>
    <div>
      <span style="color:#43a047;">Action</span><br>
      <b>${data.actionHours || 0}</b> hrs
    </div>
    <div>
      <span style="color:#2e7d32;">Service</span><br>
      <b>${data.serviceHours || 0}</b> hrs
    </div>
  </div>

  <div style="
    background:linear-gradient(90deg,#4fc3f7,#43a047);
    color:#fff;
    border-radius:10px;
    padding:10px 14px;
    font-weight:700;
    display:inline-block;
    margin-top:10px;
    box-shadow:0 0 10px rgba(67,160,71,0.35);">
    Total ${data.totalHours || 0} hrs
  </div>
</div>

<style>
  @keyframes fadeIn {
    from {opacity:0; transform:translateY(15px);}
    to {opacity:1; transform:translateY(0);}
  }
</style>
          `;
        }
      } catch (err) {
        console.error("Raw response:", text);
        summaryDiv.style.color = "orange";
        summaryDiv.innerHTML = "⚠️ Script returned invalid data:<br>" + text;
      }
    })
    .catch(err => {
      console.error("Network error:", err);
      summaryDiv.style.color = "red";
      summaryDiv.textContent = "❌ Network or permission error.";
    });
}
</script>
  



</body>

</html>

